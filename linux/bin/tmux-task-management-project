#!/bin/bash

SESSIONNAME="task-management-project"
BACK_PATH=~/myp/scicave/freelancing-task-management-backend
FRONT_PATH=~/myp/scicave/freelancing-task-management/frontend

function send-command() {
  tmux send-keys -t $SESSIONNAME "$1" C-m
}

tmux has-session -t $SESSIONNAME &> /dev/null

if [ $? != 0 ]; then
  # new session, default window for frontend
  tmux new-session -s $SESSIONNAME -n frontend -c "$FRONT_PATH" -d
  tmux-ide 2 -t $SESSIONNAME -c "$FRONT_PATH"
  send-command "yarn dev"

  # backend window
  tmux new-window -n backend -t $SESSIONNAME -c "$BACK_PATH"
  tmux send-keys -t $SESSIONNAME "source ./env/bin/activate" C-m
  tmux send-keys -t $SESSIONNAME "python manage.py runserver" C-m
  tmux split-window -v -p 70 -t $SESSIONNAME -c "$BACK_PATH"
  tmux send-keys -t $SESSIONNAME "source ./env/bin/activate" C-m

  # go back to the frontend window
  tmux select-window -t $SESSIONNAME:frontend
  tmux select-pane -t $SESSIONNAME:frontend.1
  send-command "nvim"
fi

tmux attach -t $SESSIONNAME
